<pre class="athl w-full overflow-auto rounded-lg p-8 font-mono text-sm antialiased leading-6" style="color: #c6c8d1; background-color: #161821;"><code class="language-hcl" translate="no" tabindex="0"><div class="line" data-line="1"><span data-highlight="comment" style="color: #6b7089;">// Top-level HCL file will interactively ask user values for the variables</span>
</div><div class="line" data-line="2"><span data-highlight="comment" style="color: #6b7089;">// which do not have a default value</span>
</div><div class="line" data-line="3"><span data-highlight="keyword" style="color: #84a0c6;">variable</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ready</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="4">  <span data-highlight="variable.member" style="color: #c6c8d1;">description</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">Ready to learn?</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="5">  <span data-highlight="variable.member" style="color: #c6c8d1;">type</span> = <span data-highlight="variable" style="color: #c6c8d1;">bool</span>
</div><div class="line" data-line="6">  <span data-highlight="comment" style="color: #6b7089;">// default = true</span>
</div><div class="line" data-line="7"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="8">
</div><div class="line" data-line="9"><span data-highlight="comment" style="color: #6b7089;">// Module block consults a specified folder for *.tf files, would</span>
</div><div class="line" data-line="10"><span data-highlight="comment" style="color: #6b7089;">// effectively prefix all resources IDs with &quot;module.learn-basics.&quot;</span>
</div><div class="line" data-line="11"><span data-highlight="keyword" style="color: #84a0c6;">module</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">learn-basics</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="12">  <span data-highlight="variable.member" style="color: #c6c8d1;">source</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">./learn-basics</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="13">  <span data-highlight="variable.member" style="color: #c6c8d1;">ready_to_learn</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">var</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">ready</span>
</div><div class="line" data-line="14"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="15">
</div><div class="line" data-line="16"><span data-highlight="keyword" style="color: #84a0c6;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">knowledge</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="17">  <span data-highlight="variable.member" style="color: #c6c8d1;">value</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">module</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">learn-basics</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">knowledge</span>
</div><div class="line" data-line="18"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="19">
</div><div class="line" data-line="20"><span data-highlight="comment" style="color: #6b7089;">// Variables are not automatically passed into modules</span>
</div><div class="line" data-line="21"><span data-highlight="comment" style="color: #6b7089;">// and can be typeless.</span>
</div><div class="line" data-line="22"><span data-highlight="keyword" style="color: #84a0c6;">variable</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ready</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="23"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="24">
</div><div class="line" data-line="25"><span data-highlight="comment" style="color: #6b7089;">// It is good practice to define a type though. There are 3 primitive types -</span>
</div><div class="line" data-line="26"><span data-highlight="comment" style="color: #6b7089;">// 3 collection types and 2 structural types. Structural types define</span>
</div><div class="line" data-line="27"><span data-highlight="comment" style="color: #6b7089;">// types recursively</span>
</div><div class="line" data-line="28"><span data-highlight="keyword" style="color: #84a0c6;">variable</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">structural-types</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="29">  <span data-highlight="variable.member" style="color: #c6c8d1;">type</span> = <span data-highlight="function" style="color: #a3adcb;">object</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="30">    <span data-highlight="variable.member" style="color: #c6c8d1;">object</span>: <span data-highlight="function" style="color: #a3adcb;">object</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="31">      <span data-highlight="variable.member" style="color: #c6c8d1;">can-be-nested</span>: <span data-highlight="variable" style="color: #c6c8d1;">bool</span>
</div><div class="line" data-line="32">    <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span>
</div><div class="line" data-line="33">    <span data-highlight="variable.member" style="color: #c6c8d1;">tuple</span>: <span data-highlight="function" style="color: #a3adcb;">tuple</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="variable" style="color: #c6c8d1;">int</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="variable" style="color: #c6c8d1;">string</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="34">  <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="35">
</div><div class="line" data-line="36">  <span data-highlight="variable.member" style="color: #c6c8d1;">default</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="37">    <span data-highlight="variable.member" style="color: #c6c8d1;">object</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span> <span data-highlight="variable.member" style="color: #c6c8d1;">can-be-nested</span>: <span data-highlight="boolean" style="color: #a093c7;">true</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="38">    <span data-highlight="variable.member" style="color: #c6c8d1;">tuple</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="number" style="color: #a093c7;">3</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">cm</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="39">  <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="40"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="41">
</div><div class="line" data-line="42"><span data-highlight="comment" style="color: #6b7089;">// Collection types may specify a type, but can also be &quot;any&quot;.</span>
</div><div class="line" data-line="43"><span data-highlight="keyword" style="color: #84a0c6;">variable</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">list</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="44">  <span data-highlight="type" style="color: #84a0c6;">type</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;"></span>: list(string)
</div><div class="line" data-line="45">  default = [<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">red</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">green</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">blue</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="46">&rbrace;
</div><div class="line" data-line="47">
</div><div class="line" data-line="48">variable <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">map</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="49">  <span data-highlight="variable.member" style="color: #c6c8d1;">type</span>: map(any)
</div><div class="line" data-line="50">  default = &lbrace;
</div><div class="line" data-line="51">    red = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">#FF0000</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="52">    <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">green</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">#00FF00</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="53">  <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="54"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="55">
</div><div class="line" data-line="56"><span data-highlight="keyword" style="color: #84a0c6;">variable</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">favourites</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="57">  <span data-highlight="type" style="color: #84a0c6;">type</span>: set
</div><div class="line" data-line="58">  default = [<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">red</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">blue</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="59">&rbrace;
</div><div class="line" data-line="60">
</div><div class="line" data-line="61">// When the type is not specified or is a mix of scalars
</div><div class="line" data-line="62">// they will be converted to strings.
</div><div class="line" data-line="63">
</div><div class="line" data-line="64">// Use modern IDEs for type completion features. It does not matter
</div><div class="line" data-line="65">// in which file and in which order you define a variable, it becomes
</div><div class="line" data-line="66">// accessible from anywhere.
</div><div class="line" data-line="67">
</div><div class="line" data-line="68">// Default values for variables may not use expressions, but you can
</div><div class="line" data-line="69">// use locals for that. You don&#39;t specify types for locals. With locals
</div><div class="line" data-line="70">// you can create intermediate products from other variables, modules,
</div><div class="line" data-line="71">// and functions.
</div><div class="line" data-line="72">
</div><div class="line" data-line="73">locals &lbrace;
</div><div class="line" data-line="74">  ready = var.ready ? <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">yes</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>: <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">no</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="75">
</div><div class="line" data-line="76">  <span data-highlight="type" style="color: #84a0c6;">yaml</span> = yamldecode(file(<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">$&lbrace;path.module&rbrace;/file-in-current-folder.yaml</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>)
</div><div class="line" data-line="77">&rbrace;
</div><div class="line" data-line="78">
</div><div class="line" data-line="79">// &#39;locals&#39; blocks can be defined multiple times, but all variables,
</div><div class="line" data-line="80">// resources and local names should be unique
</div><div class="line" data-line="81">
</div><div class="line" data-line="82">locals &lbrace;
</div><div class="line" data-line="83">  set = toset(var.map)
</div><div class="line" data-line="84">&rbrace;
</div><div class="line" data-line="85">
</div><div class="line" data-line="86">module <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">more-resources</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="87">  <span data-highlight="variable.member" style="color: #c6c8d1;">source</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">../more-learning</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="88">  <span data-highlight="variable.member" style="color: #c6c8d1;">yaml-data</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">yaml</span>
</div><div class="line" data-line="89"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="90">
</div><div class="line" data-line="91"><span data-highlight="comment" style="color: #6b7089;">// Modules can declare outputs, that can be optionally referenced</span>
</div><div class="line" data-line="92"><span data-highlight="comment" style="color: #6b7089;">// (see above), typically outputs appear at the bottom of the file or</span>
</div><div class="line" data-line="93"><span data-highlight="comment" style="color: #6b7089;">// in &quot;outputs.tf&quot;.</span>
</div><div class="line" data-line="94"><span data-highlight="type" style="color: #84a0c6;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">knowledge</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="95">  <span data-highlight="variable.member" style="color: #c6c8d1;">value</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">types so far, more to come</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="96"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="97">
</div><div class="line" data-line="98"><span data-highlight="type" style="color: #84a0c6;">variable</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">yaml-data</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="99">
</div><div class="line" data-line="100">  <span data-highlight="comment" style="color: #6b7089;">// config is sourced from a .yaml file, so technically it is a</span>
</div><div class="line" data-line="101">  <span data-highlight="comment" style="color: #6b7089;">// map(any), but we can narrow down type like this:</span>
</div><div class="line" data-line="102">  <span data-highlight="variable.member" style="color: #c6c8d1;">type</span> = <span data-highlight="function" style="color: #a3adcb;">map</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="variable" style="color: #c6c8d1;">string</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="103"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="104">
</div><div class="line" data-line="105"><span data-highlight="comment" style="color: #6b7089;">// You do not need to explicitly define providers, they all have reasonable</span>
</div><div class="line" data-line="106"><span data-highlight="comment" style="color: #6b7089;">// defaults with environment variables. Using a resource that relies on a</span>
</div><div class="line" data-line="107"><span data-highlight="comment" style="color: #6b7089;">// provider will also transparently initialize it (when you invoke terraform init)</span>
</div><div class="line" data-line="108"><span data-highlight="type" style="color: #84a0c6;">resource</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_s3_bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="109">  <span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">abc</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="110"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="111">
</div><div class="line" data-line="112"><span data-highlight="comment" style="color: #6b7089;">// You can also create provider aliases</span>
</div><div class="line" data-line="113"><span data-highlight="type" style="color: #84a0c6;">provider</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="114">  <span data-highlight="variable.member" style="color: #c6c8d1;">alias</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">as-role</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="115">  <span data-highlight="type" style="color: #84a0c6;">assume_role</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="116">    <span data-highlight="variable.member" style="color: #c6c8d1;">role_arn</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">..</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="117">  <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="118"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="119">
</div><div class="line" data-line="120"><span data-highlight="comment" style="color: #6b7089;">// then use them to create resources</span>
</div><div class="line" data-line="121"><span data-highlight="type" style="color: #84a0c6;">resource</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_s3_bucket_object</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">test-file</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="122">
</div><div class="line" data-line="123">  <span data-highlight="comment" style="color: #6b7089;">// all resources have attributes that can be referenced. Some of those</span>
</div><div class="line" data-line="124">  <span data-highlight="comment" style="color: #6b7089;">// will be available right away (like bucket) and others may only</span>
</div><div class="line" data-line="125">  <span data-highlight="comment" style="color: #6b7089;">// become available after the plan begins executing. The test-file resource</span>
</div><div class="line" data-line="126">  <span data-highlight="comment" style="color: #6b7089;">// will be created only after aws_s3_bucket.bucket finishes being created</span>
</div><div class="line" data-line="127">
</div><div class="line" data-line="128">  <span data-highlight="comment" style="color: #6b7089;">// depends_on = aws_s3_bucket.bucket</span>
</div><div class="line" data-line="129">  <span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span>
</div><div class="line" data-line="130">  <span data-highlight="variable.member" style="color: #c6c8d1;">key</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">index.html</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="131">  <span data-highlight="variable.member" style="color: #c6c8d1;">content</span> = <span data-highlight="function" style="color: #a3adcb;">file</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.special" style="color: #b4be82;">$&lbrace;</span><span data-highlight="variable.builtin" style="color: #84a0c6;">path</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">module</span><span data-highlight="punctuation.special" style="color: #b4be82;">&rbrace;</span><span data-highlight="string" style="color: #89b8c2;">/index.html</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="132">
</div><div class="line" data-line="133">  <span data-highlight="comment" style="color: #6b7089;">// you can also manually specify provider alias</span>
</div><div class="line" data-line="134">  <span data-highlight="variable.member" style="color: #c6c8d1;">provider</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">aws</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">as-role</span>
</div><div class="line" data-line="135"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="136">
</div><div class="line" data-line="137"><span data-highlight="comment" style="color: #6b7089;">// Each resource will receive an ID in state, like &quot;aws_s3_bucket.bucket&quot;.</span>
</div><div class="line" data-line="138"><span data-highlight="comment" style="color: #6b7089;">// When resources are created inside a module, their state ID is prepended</span>
</div><div class="line" data-line="139"><span data-highlight="comment" style="color: #6b7089;">// with module.&lt;module-name&gt;</span>
</div><div class="line" data-line="140">
</div><div class="line" data-line="141"><span data-highlight="type" style="color: #84a0c6;">module</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">learn-each</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="142">  <span data-highlight="variable.member" style="color: #c6c8d1;">source</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">../learn-each</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="143"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="144">
</div><div class="line" data-line="145"><span data-highlight="comment" style="color: #6b7089;">// Nesting modules like this may not be the best practice, and it&#39;s only</span>
</div><div class="line" data-line="146"><span data-highlight="comment" style="color: #6b7089;">// used here for illustration purposes</span>
</div><div class="line" data-line="147">
</div><div class="line" data-line="148"><span data-highlight="type" style="color: #84a0c6;">locals</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="149">  <span data-highlight="variable.member" style="color: #c6c8d1;">list</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">red</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">green</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">blue</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="150"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="151"><span data-highlight="type" style="color: #84a0c6;">resource</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_s3_bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">badly-coloured-bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="152">  <span data-highlight="variable.member" style="color: #c6c8d1;">count</span> = <span data-highlight="function" style="color: #a3adcb;">count</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">list</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="153">  <span data-highlight="variable.member" style="color: #c6c8d1;">bucket_prefix</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.special" style="color: #b4be82;">$&lbrace;</span><span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">list</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="variable.builtin" style="color: #84a0c6;">count</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">index</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span><span data-highlight="punctuation.special" style="color: #b4be82;">&rbrace;</span><span data-highlight="string" style="color: #89b8c2;">-</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="154"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="155"><span data-highlight="comment" style="color: #6b7089;">// will create 3 buckets, prefixed with &quot;red-&quot;, etc. and followed by</span>
</div><div class="line" data-line="156"><span data-highlight="comment" style="color: #6b7089;">// a unique identifier. Some resources will automatically generate</span>
</div><div class="line" data-line="157"><span data-highlight="comment" style="color: #6b7089;">// a random name if not specified. The actual name of the resource</span>
</div><div class="line" data-line="158"><span data-highlight="comment" style="color: #6b7089;">// (or bucket in this example) can be referenced as attributes</span>
</div><div class="line" data-line="159">
</div><div class="line" data-line="160"><span data-highlight="type" style="color: #84a0c6;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">red-bucket-name</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="161">  <span data-highlight="variable.member" style="color: #c6c8d1;">value</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">badly-coloured-bucket</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="number" style="color: #a093c7;">0</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span>
</div><div class="line" data-line="162"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="163">
</div><div class="line" data-line="164"><span data-highlight="comment" style="color: #6b7089;">// note that bucket resource ID will be &quot;aws_s3_bucket.badly-coloured-bucket[0]&quot;</span>
</div><div class="line" data-line="165"><span data-highlight="comment" style="color: #6b7089;">// through to 2, because they are list index elements. If you remove &quot;red&quot; from</span>
</div><div class="line" data-line="166"><span data-highlight="comment" style="color: #6b7089;">// the list, however, it will re-create all the buckets as they would now</span>
</div><div class="line" data-line="167"><span data-highlight="comment" style="color: #6b7089;">// have new IDs. A better way is to use for_each</span>
</div><div class="line" data-line="168">
</div><div class="line" data-line="169"><span data-highlight="type" style="color: #84a0c6;">resource</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_s3_bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">coloured-bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="170">  <span data-highlight="comment" style="color: #6b7089;">// for_each only supports maps and sets</span>
</div><div class="line" data-line="171">  <span data-highlight="variable.member" style="color: #c6c8d1;">for_each</span> = <span data-highlight="function" style="color: #a3adcb;">toset</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">list</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="172">  <span data-highlight="variable.member" style="color: #c6c8d1;">bucket_prefix</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.special" style="color: #b4be82;">$&lbrace;</span><span data-highlight="variable.builtin" style="color: #84a0c6;">each</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">value</span><span data-highlight="punctuation.special" style="color: #b4be82;">&rbrace;</span><span data-highlight="string" style="color: #89b8c2;">-</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="173"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="174">
</div><div class="line" data-line="175"><span data-highlight="comment" style="color: #6b7089;">// the name for this resource would be aws_s3_bucket.coloured-bucket[red]</span>
</div><div class="line" data-line="176">
</div><div class="line" data-line="177"><span data-highlight="type" style="color: #84a0c6;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">red-bucket-name2</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="178">  <span data-highlight="variable.member" style="color: #c6c8d1;">value</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">badly-coloured-bucket</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">red</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span>
</div><div class="line" data-line="179"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="180">
</div><div class="line" data-line="181"><span data-highlight="type" style="color: #84a0c6;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">all-bucket-names</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="182">
</div><div class="line" data-line="183">  <span data-highlight="comment" style="color: #6b7089;">// returns a list containing bucket names - using a &quot;splat expression&quot;</span>
</div><div class="line" data-line="184">  <span data-highlight="variable.member" style="color: #c6c8d1;">value</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">coloured-bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">[*]</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">bucket</span>
</div><div class="line" data-line="185"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="186">
</div><div class="line" data-line="187"><span data-highlight="comment" style="color: #6b7089;">// there are other splat expressions:</span>
</div><div class="line" data-line="188"><span data-highlight="type" style="color: #84a0c6;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">all-bucket-names2</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="189">  <span data-highlight="variable.member" style="color: #c6c8d1;">value</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="keyword.repeat" style="color: #84a0c6;">for</span> <span data-highlight="variable" style="color: #c6c8d1;">b</span> <span data-highlight="keyword.repeat" style="color: #84a0c6;">in</span> <span data-highlight="variable.builtin" style="color: #84a0c6;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">coloured-bucket</span>: <span data-highlight="variable.builtin" style="color: #84a0c6;">b</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="190"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="191"><span data-highlight="comment" style="color: #6b7089;">// can also include a filter</span>
</div><div class="line" data-line="192"><span data-highlight="type" style="color: #84a0c6;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">filtered-bucket-names</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="193">  <span data-highlight="variable.member" style="color: #c6c8d1;">value</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="keyword.repeat" style="color: #84a0c6;">for</span> <span data-highlight="variable" style="color: #c6c8d1;">b</span> <span data-highlight="keyword.repeat" style="color: #84a0c6;">in</span> <span data-highlight="variable.builtin" style="color: #84a0c6;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">coloured-bucket</span>:
</div><div class="line" data-line="194">    <span data-highlight="variable.builtin" style="color: #84a0c6;">b</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span> <span data-highlight="keyword.conditional" style="color: #84a0c6;">if</span> <span data-highlight="function" style="color: #a3adcb;">length</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="variable.builtin" style="color: #84a0c6;">b</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span> <span data-highlight="operator" style="color: #c6c8d1;">&lt;</span> <span data-highlight="number" style="color: #a093c7;">10</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="195"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="196">
</div><div class="line" data-line="197"><span data-highlight="comment" style="color: #6b7089;">// here are some ways to generate maps &lbrace;red: &quot;red-123123..&quot;&rbrace;</span>
</div><div class="line" data-line="198"><span data-highlight="variable" style="color: #c6c8d1;">output</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">bucket-map</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="199">  <span data-highlight="variable" style="color: #c6c8d1;">value</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="200">    <span data-highlight="keyword.repeat" style="color: #84a0c6;">for</span> <span data-highlight="variable" style="color: #c6c8d1;">b</span> <span data-highlight="keyword.repeat" style="color: #84a0c6;">in</span> <span data-highlight="variable.builtin" style="color: #84a0c6;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">coloured-bucket</span>:
</div><div class="line" data-line="201">       <span data-highlight="variable" style="color: #c6c8d1;">trimsuffix</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="variable.builtin" style="color: #84a0c6;">b</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket_prefix</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> &#39;-&#39;)
</div><div class="line" data-line="202">         =&gt; b.bucket
</div><div class="line" data-line="203">   &rbrace;
</div><div class="line" data-line="204">&rbrace;
</div><div class="line" data-line="205">
</div><div class="line" data-line="206">// as of Terraform 0.13 it is now also possible to use count/each for modules
</div><div class="line" data-line="207">
</div><div class="line" data-line="208">variable <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">learn-functions</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="209">  <span data-highlight="variable.member" style="color: #c6c8d1;">type</span> = <span data-highlight="variable" style="color: #c6c8d1;">bool</span>
</div><div class="line" data-line="210">  <span data-highlight="variable.member" style="color: #c6c8d1;">default</span> = <span data-highlight="boolean" style="color: #a093c7;">true</span>
</div><div class="line" data-line="211"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="212">
</div><div class="line" data-line="213"><span data-highlight="variable" style="color: #c6c8d1;">module</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">learn-functions</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="214">  <span data-highlight="variable.member" style="color: #c6c8d1;">count</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">var</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">learn-functions</span> <span data-highlight="punctuation.special" style="color: #b4be82;">?</span> <span data-highlight="number" style="color: #a093c7;">1</span>: <span data-highlight="number" style="color: #a093c7;">0</span>
</div><div class="line" data-line="215">  <span data-highlight="variable.member" style="color: #c6c8d1;">source</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">../learn-functions</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="216"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="217">
</div><div class="line" data-line="218"><span data-highlight="variable" style="color: #c6c8d1;">locals</span> &lbrace;
</div><div class="line" data-line="219">  list = [<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">one</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">two</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">three</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="220">
</div><div class="line" data-line="221">  upper_list = [for x in local.list : upper(x) ] // <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ONE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">TWO</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">THREE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="222">
</div><div class="line" data-line="223">  <span data-highlight="variable" style="color: #c6c8d1;">map</span> = &lbrace;for x in local.list : x =&gt; upper(x) &rbrace; // <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">one</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>:<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ONE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">two</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>:<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">TWO</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">three</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>:<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">THREE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="224">
</div><div class="line" data-line="225">  <span data-highlight="variable" style="color: #c6c8d1;">filtered_list</span> = [for k, v in local.map : substr(v, 0, 2) if k != <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">two</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span> // <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ON</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">TH</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="226">
</div><div class="line" data-line="227">  <span data-highlight="variable" style="color: #c6c8d1;">prefixed_list</span> = [for v in local.filtered_list : <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-</span><span data-highlight="punctuation.special" style="color: #b4be82;">$&lbrace;</span><span data-highlight="variable" style="color: #c6c8d1;">v</span><span data-highlight="punctuation.special" style="color: #b4be82;">&rbrace;</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span> // <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-ON</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-TH</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="228">
</div><div class="line" data-line="229">  <span data-highlight="variable" style="color: #c6c8d1;">joined_list</span> = join(local.upper_list,local. filtered_list) // <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ONE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">TWO</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">THREE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-ON</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-TH</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="230">
</div><div class="line" data-line="231">  <span data-highlight="comment" style="color: #6b7089;">// Set is very similar to List, but element order is irrelevant</span>
</div><div class="line" data-line="232">  <span data-highlight="variable" style="color: #c6c8d1;">joined_set</span> = toset(local.joined_list) // <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ONE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">TWO</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">THREE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-ON</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-TH</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="233">
</div><div class="line" data-line="234">  <span data-highlight="variable" style="color: #c6c8d1;">map_again</span> = map(slice(local.joined_list, 0, 4)) // <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ONE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>:<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">TWO</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">THREE</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>:<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">pre-ON</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="235"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="236">
</div><div class="line" data-line="237">// Usually list manipulation can be useful either for a resource with for_each or
</div><div class="line" data-line="238">// to specify a dynamic block for a resource. This creates a bucket with some tags:
</div><div class="line" data-line="239">
</div><div class="line" data-line="240">resource <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_s3_bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="241">  <span data-highlight="variable.member" style="color: #c6c8d1;">name</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">test-bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="242">  <span data-highlight="variable.member" style="color: #c6c8d1;">tags</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">map_again</span>
</div><div class="line" data-line="243"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="244">
</div><div class="line" data-line="245"><span data-highlight="comment" style="color: #6b7089;">// this is identical to:</span>
</div><div class="line" data-line="246"><span data-highlight="comment" style="color: #6b7089;">// resource &quot;aws_s3_bucket&quot; &quot;bucket&quot; &lbrace;</span>
</div><div class="line" data-line="247"><span data-highlight="comment" style="color: #6b7089;">//   name = &quot;test-bucket&quot;</span>
</div><div class="line" data-line="248"><span data-highlight="comment" style="color: #6b7089;">//   tags = &lbrace;</span>
</div><div class="line" data-line="249"><span data-highlight="comment" style="color: #6b7089;">//     ONE = &quot;TWO&quot;</span>
</div><div class="line" data-line="250"><span data-highlight="comment" style="color: #6b7089;">//     THREE = &quot;pre-ON&quot;</span>
</div><div class="line" data-line="251"><span data-highlight="comment" style="color: #6b7089;">//   &rbrace;</span>
</div><div class="line" data-line="252"><span data-highlight="comment" style="color: #6b7089;">// &rbrace;</span>
</div><div class="line" data-line="253">
</div><div class="line" data-line="254"><span data-highlight="comment" style="color: #6b7089;">// Some resources also contain dynamic blocks. The next example uses a &quot;data&quot; block</span>
</div><div class="line" data-line="255"><span data-highlight="comment" style="color: #6b7089;">// to look up 3 buckets (red, green and blue), then creates a policy that contains</span>
</div><div class="line" data-line="256"><span data-highlight="comment" style="color: #6b7089;">// read-only access to the red and green buckets and full access to the blue bucket.</span>
</div><div class="line" data-line="257">
</div><div class="line" data-line="258"><span data-highlight="variable" style="color: #c6c8d1;">locals</span> &lbrace;
</div><div class="line" data-line="259">  buckets = &lbrace;
</div><div class="line" data-line="260">    red = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">read-only</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="261">    <span data-highlight="variable" style="color: #c6c8d1;">green</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">read-only</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="262">    <span data-highlight="variable" style="color: #c6c8d1;">blue</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">full</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="263">  <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="264">  // we could load buckets from a file:
</div><div class="line" data-line="265">  // bucket = file(&#39;bucket.json&#39;)
</div><div class="line" data-line="266">
</div><div class="line" data-line="267">  actions = &lbrace;
</div><div class="line" data-line="268">    <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">read-only</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> = [<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">s3:GetObject</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">s3:GetObjectVersion</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>,
</div><div class="line" data-line="269">    <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">full</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> = [<span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">s3:GetObject</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">s3:GetObjectVersion</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">s3:PutObject</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">s3:PutObjectVersion</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="270">  &rbrace;
</div><div class="line" data-line="271">  // we will look up actions, so that we don&#39;t have to repeat actions
</div><div class="line" data-line="272">&rbrace;
</div><div class="line" data-line="273">
</div><div class="line" data-line="274">// use a function to convert map keys into set
</div><div class="line" data-line="275">data <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_s3_bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">bucket</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="276">  <span data-highlight="variable.member" style="color: #c6c8d1;">for_each</span> = <span data-highlight="function" style="color: #a3adcb;">toset</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="function" style="color: #a3adcb;">keys</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">buckets</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="277">  <span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">each</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">value</span>
</div><div class="line" data-line="278"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="279">
</div><div class="line" data-line="280"><span data-highlight="comment" style="color: #6b7089;">// create json for our policy</span>
</div><div class="line" data-line="281"><span data-highlight="variable" style="color: #c6c8d1;">data</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_iam_policy_document</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">role_policy</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="282">  <span data-highlight="variable" style="color: #c6c8d1;">statement</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="283">    <span data-highlight="variable.member" style="color: #c6c8d1;">effect</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">Allow</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="284">    <span data-highlight="variable.member" style="color: #c6c8d1;">actions</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span>
</div><div class="line" data-line="285">      <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">ec2:*</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span>
</div><div class="line" data-line="286">    <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="287">    <span data-highlight="variable.member" style="color: #c6c8d1;">resources</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">*</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="288">  <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="289">
</div><div class="line" data-line="290">  <span data-highlight="variable" style="color: #c6c8d1;">dynamic</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">statement</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="291">    <span data-highlight="variable.member" style="color: #c6c8d1;">for_each</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">buckets</span>
</div><div class="line" data-line="292">    <span data-highlight="variable" style="color: #c6c8d1;">content</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="293">      <span data-highlight="variable.member" style="color: #c6c8d1;">effect</span> = <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">Allow</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span>
</div><div class="line" data-line="294">      <span data-highlight="variable.member" style="color: #c6c8d1;">actions</span> = <span data-highlight="function" style="color: #a3adcb;">lookup</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">(</span><span data-highlight="variable.builtin" style="color: #84a0c6;">local</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">actions</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="variable.builtin" style="color: #84a0c6;">statement</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">value</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">,</span> <span data-highlight="constant" style="color: #a093c7;">null</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">)</span>
</div><div class="line" data-line="295">      <span data-highlight="variable.member" style="color: #c6c8d1;">resources</span> = <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="variable.builtin" style="color: #84a0c6;">data</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">aws_s3_bucket</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">bucket</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">[</span><span data-highlight="variable.builtin" style="color: #84a0c6;">statement</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">key</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">]</span>
</div><div class="line" data-line="296">    <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="297">  <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="298">&rbrace;
</div><div class="line" data-line="299">
</div><div class="line" data-line="300">// and this actually creates the AWS policy with permissions to all buckets
</div><div class="line" data-line="301">resource <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">aws_iam_policy</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="string" style="color: #89b8c2;">&quot;</span><span data-highlight="string" style="color: #89b8c2;">policy</span><span data-highlight="string" style="color: #89b8c2;">&quot;</span> <span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&lbrace;</span>
</div><div class="line" data-line="302">  <span data-highlight="variable.member" style="color: #c6c8d1;">policy</span> = <span data-highlight="variable.builtin" style="color: #84a0c6;">data</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">aws_iam_policy_document</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable" style="color: #c6c8d1;">role_policy</span><span data-highlight="punctuation.delimiter" style="color: #c6c8d1;">.</span><span data-highlight="variable.member" style="color: #c6c8d1;">json</span>
</div><div class="line" data-line="303"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;">&rbrace;</span>
</div><div class="line" data-line="304"><span data-highlight="punctuation.bracket" style="color: #c6c8d1;"></span>
</div></code></pre>